(function(X,I){typeof exports=="object"&&typeof module<"u"?module.exports=I():typeof define=="function"&&define.amd?define(I):(X=typeof globalThis<"u"?globalThis:X||self,X.draggle=I())})(this,function(){"use strict";function X(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var I=function(n,o){return Array.prototype.slice.call(n,o)},me=typeof setImmediate=="function",k;me?k=function(t){setImmediate(t)}:k=function(t){setTimeout(t,0)};var pe=k,ge=pe,ve=function(n,o,l){n&&ge(function(){n.apply(l||null,o||[])})},K=I,he=ve,be=function(n,o){var l=o||{},c={};return n===void 0&&(n={}),n.on=function(d,h){return c[d]?c[d].push(h):c[d]=[h],n},n.once=function(d,h){return h._once=!0,n.on(d,h),n},n.off=function(d,h){var S=arguments.length;if(S===1)delete c[d];else if(S===0)c={};else{var C=c[d];if(!C)return n;C.splice(C.indexOf(h),1)}return n},n.emit=function(){var d=K(arguments);return n.emitterSnapshot(d.shift()).apply(this,d)},n.emitterSnapshot=function(d){var h=(c[d]||[]).slice(0);return function(){var S=K(arguments),C=this||n;if(d==="error"&&l.throws!==!1&&!h.length)throw S.length===1?S[0]:S;return h.forEach(function(E){l.async?he(E,S,C):E.apply(C,S),E._once&&n.off(d,E)}),n}},n};const ye=X(be),G={},Se="(?:^|\\s)",Ee="(?:\\s|$)";function U(t){let n=G[t];return n?n.lastIndex=0:G[t]=n=new RegExp(Se+t+Ee,"g"),n}function L(t,n){const o=t.className;o.length?U(n).test(o)||(t.className+=" "+n):t.className=n}function R(t,n){t.className=t.className.replace(U(n)," ").trim()}const Ce=(t,n)=>({containers:n,moves:()=>!0,accepts:()=>!0,invalid:()=>!1,isContainer:()=>!1,transformOffset:o=>o,copy:!1,copySortSource:!1,revertOnSpill:!1,removeOnSpill:!1,direction:"vertical",ignoreInputTextSelection:!0,mirrorContainer:document.body,...t});function V(t){if(t.touches!==void 0)return t.touches.length;if(t.which!==void 0&&t.which!==0)return t.which;if(t.buttons!==void 0)return t.buttons;const n=t.button;if(n!==void 0)return n&1?1:n&2?3:n&4?2:0}const we=t=>{const n=t.getBoundingClientRect();return{left:n.left+W("scrollLeft","pageXOffset"),top:n.top+W("scrollTop","pageYOffset")}},W=(t,n)=>typeof global[n]<"u"?global[n]:document.documentElement.clientHeight?document.documentElement[t]:document.body[t],q=(t={},n,o)=>{const l=t.className||"";t.className+=" gu-hide";const c=document.elementFromPoint(n,o);return t.className=l,c},J=t=>t.width||t.right-t.left,Q=t=>t.height||t.bottom-t.top,g=t=>t.parentNode===document?null:t.parentNode,Z=t=>["INPUT","TEXTAREA","SELECT"].includes(t.tagName)||ee(t),ee=t=>!t||t.contentEditable==="false"?!1:t.contentEditable==="true"?!0:ee(g(t)),Y=t=>{const n=()=>{let o=t;do o=o.nextSibling;while(o&&o.nodeType!==1);return o};return t.nextElementSibling||n()};window.global||(window.global=window);const te=document,N=te.documentElement;function Oe(t=[],n={}){Array.isArray(t)||(n=t,t=[]);let o,l,c,d,h,S,C,M,E,a,A,T,x;const s=Ce(n,t),f=ye({containers:s.containers,start:Xe,end:oe,cancel:se,remove:le,destroy:_e,canMove:Me,dragging:!1});return s.removeOnSpill&&f.on("over",Ie).on("out",Ye),ne(),f;function D(e){return f.containers.indexOf(e)!==-1||s.isContainer(e)}function ne(e){const r=e?"removeEventListener":"addEventListener";N[r]("pointerdown",Te,!0),N[r]("pointerup",$,!0)}function F(e){N[e?"removeEventListener":"addEventListener"]("pointermove",Be,!0)}function re(e){N[e?"removeEventListener":"addEventListener"]("click",Ne,!0)}function _e(){ne(!0),$({})}function Ne(e){x&&e.preventDefault()}function Te(e){if(S=e.clientX,C=e.clientY,V(e)!==1||e.metaKey||e.ctrlKey)return;const i=e.target,u=P(i);u&&(x=u,F(),e.type==="pointerdown"&&(Z(i)?i.focus():e.preventDefault()))}function Be(e){if(!x)return;if(V(e)===0){$({});return}if(e.clientX!==void 0&&Math.abs(e.clientX-S)<=(s.slideFactorX||0)&&e.clientY!==void 0&&Math.abs(e.clientY-C)<=(s.slideFactorY||0))return;if(s.ignoreInputTextSelection){const{clientX:O=0,clientY:m=0}=e,w=te.elementFromPoint(O,m);if(Z(w))return}const r=x;F(!0),re(),oe(),ie(r);const i=we(c),u=s.transformOffset(i,e,c),{pageX:v=0,pageY:p=0}=e;d=v-u.left,h=p-u.top,L(a||c,"gu-transit"),xe(),H(e)}function P(e){if(f.dragging&&o||D(e))return;const r=e;for(;g(e)&&D(g(e))===!1;)if(s.invalid(e,r)||(e=g(e),!e))return;const i=g(e);if(!(!i||s.invalid(e,r)||!s.moves(e,i,r,Y(e))))return{item:e,source:i}}function Me(e){return!!P(e)}function Xe(e){const r=P(e);r&&ie(r)}function ie(e){Re(e.item,e.source)&&(a=e.item.cloneNode(!0),f.emit("cloned",a,e.item,"copy")),l=e.source,c=e.item,M=E=Y(e.item),f.dragging=!0,f.emit("drag",c,l)}function oe(){if(!f.dragging)return;const e=a||c;ue(e,g(e))}function ce(){x=!1,F(!0),re(!0)}function $(e){if(ce(),!f.dragging)return;const r=a||c,{clientX:i=0,clientY:u=0}=e,v=q(o,i,u),p=fe(v,i,u);p&&(a&&s.copySortSource||!a||p!==l)?ue(r,p):s.removeOnSpill?le():se()}function ue(e,r){const i=g(e);a&&s.copySortSource&&r===l&&i.removeChild(c),z(r)?f.emit("cancel",e,l,l):f.emit("drop",e,r,l,E),j()}function le(){if(!f.dragging)return;const e=a||c,r=g(e);r&&r.removeChild(e),f.emit(a?"cancel":"remove",e,r,l),j()}function se(e){if(!f.dragging)return;const r=arguments.length>0?e:s.revertOnSpill,i=a||c,u=g(i),v=z(u);v===!1&&r&&(a?u&&u.removeChild(a):l.insertBefore(i,M)),v||r?f.emit("cancel",i,l,l):f.emit("drop",i,u,l,E),j()}function j(){const e=a||c;ce(),Le(),e&&R(e,"gu-transit"),A&&clearTimeout(A),f.dragging=!1,T&&f.emit("out",e,T,l),f.emit("dragend",e),l=c=a=M=E=A=T=null}function z(e,r){let i;return r!==void 0?i=r:o?i=E:i=Y(a||c),e===l&&i===M}function fe(e,r,i){let u=e;for(;u&&!v();)u=g(u);return u;function v(){if(D(u)===!1)return!1;const O=ae(u,e),m=de(u,O,r,i);return z(u,m)?!0:s.accepts(c,u,l,m)}}function H(e){if(!o)return;e.preventDefault();const{clientX:r=0,clientY:i=0}=e,u=r-d,v=i-h;o.style.left=u+"px",o.style.top=v+"px";const p=a||c,O=q(o,r,i);let m=fe(O,r,i);const w=m!==null&&m!==T;(w||m===null)&&(Ae(),T=m,ke());const b=g(p);if(m===l&&a&&!s.copySortSource){b&&b.removeChild(p);return}let y;const B=ae(m,O);if(B!==null)y=de(m,B,r,i);else if(s.revertOnSpill===!0&&!a)y=M,m=l;else{a&&b&&b.removeChild(p);return}(y===null&&w||y!==p&&y!==Y(p))&&(E=y,m.insertBefore(p,y),f.emit("shadow",p,m,l));function _(De){f.emit(De,p,T,l)}function ke(){w&&_("over")}function Ae(){T&&_("out")}}function Ie(e){R(e,"gu-hide")}function Ye(e){f.dragging&&L(e,"gu-hide")}function xe(){if(o)return;const e=c.getBoundingClientRect();o=c.cloneNode(!0),o.style.width=J(e)+"px",o.style.height=Q(e)+"px",R(o,"gu-transit"),L(o,"gu-mirror"),s.mirrorContainer.appendChild(o),N.addEventListener("pointermove",H),L(s.mirrorContainer,"gu-unselectable"),f.emit("cloned",o,c,"mirror")}function Le(){o&&(R(s.mirrorContainer,"gu-unselectable"),N.removeEventListener("pointermove",H),g(o).removeChild(o),o=null)}function ae(e,r){let i=r;for(;i!==e&&g(i)!==e;)i=g(i);return i===N?null:i}function de(e,r,i,u){const v=(typeof s.direction=="function"?s.direction(c,e,l):s.direction)==="horizontal";return r!==e?m():O();function O(){const b=e.children.length;let y,B,_;for(y=0;y<b;y++)if(B=e.children[y],_=B.getBoundingClientRect(),v&&_.left+_.width/2>i||!v&&_.top+_.height/2>u)return B;return null}function m(){const b=r.getBoundingClientRect();return w(v?i>b.left+J(b)/2:u>b.top+Q(b)/2)}function w(b){return b?Y(r):r}}function Re(e,r){return typeof s.copy=="boolean"?s.copy:s.copy(e,r)}}return Oe});
