<div class="p-4">
  <div class="flex items-center justify-between my-4 gap-2">
    <span>Atribuir Responsável</span>
    @if(igualUsuarioLogado()){
    <div (click)="unassignUser()"
      class="flex items-center justify-center bg-teal-100 dark:bg-teal-400/10 rounded-full cursor-pointer hover-icon"
      style="width: 2rem; height: 2rem">
      <i class="pi pi-users text-teal-500 !text-mediun"></i>
    </div>
    }@else{
    <div (click)="assumir()"
      class="flex items-center justify-center bg-red-100 dark:bg-red-400/10 rounded-full cursor-pointer hover-icon"
      style="width: 2rem; height: 2rem">
      <i class="pi pi-user-plus text-red-400 !text-mediun"></i>
    </div>
    }
  </div>

  <!-- 2. Usuário Atribuído -->
  @if(!isFiltro){
  <div class="mb-6">
    <h3 class="font-semibold text-lg mb-2 text-surface-700 dark:text-surface-200">Atribuído a</h3>
    <div *ngIf="assignedUser; else noAssignedUser"
      class="flex items-center justify-between p-3 bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-900/30 rounded-lg">
      <div class="flex items-center gap-3">
        <p-avatar [label]="getInitials(assignedUser)" severity="info" shape="circle"
          styleClass="bg-primary-500 text-white font-bold"></p-avatar>
        <div>
          <span class="font-bold block">{{ assignedUser.firstName }} {{ assignedUser.lastName }}</span>
          <small class="text-surface-500">{{ assignedUser.email }}</small>
        </div>
      </div>
      <button pButton type="button" icon="pi pi-times" class="p-button-danger p-button-text" (click)="unassignUser()"
        pTooltip="Remover atribuição"></button>
    </div>
    <ng-template #noAssignedUser>
      <div class="text-center p-4 border-2 border-dashed border-surface-200 dark:border-surface-700 rounded-lg">
        <p class="text-surface-500">Nenhum usuário atribuído</p>
      </div>
    </ng-template>
  </div>
  }

  <!-- 1. Pesquisa -->
  <div class="flex gap-5">
    <p-iconfield iconPosition="left" [style]="{'width': '100%', 'max-width': '400px'}">
      <input pInputText type="text" #input [(ngModel)]="searchTerm" (input)="filterUsers()"
        placeholder="Pesquisar usuário por nome..." style="width: 100%;max-width: 400px;" />
      <p-inputicon class="pi pi-search" />
    </p-iconfield>
    @if(isFiltro){
    <div class="flex">
      <button pButton type="button" label="Remover" severity="warn" outlined="true"
        class="p-button-sm p-button-outlined w-[60px]" (click)="unssigneeEmit.emit()"></button>
    </div>
    }
  </div>


  <!-- 3. Lista de Usuários Disponíveis -->
  <div class="mt-2">
    <div *ngIf="availableUsers.length > 0; else noAvailableUsers">
      <div *ngFor="let user of availableUsers"
        class="flex items-center justify-between gap-3 py-2 rounded-lg transition-colors duration-200 hover:bg-surface-100 dark:hover:bg-surface-700">
        <div class="flex items-center gap-3">
          <p-avatar [label]="getInitials(user)" severity="info" shape="circle"></p-avatar>
          <div>
            <span class="font-semibold">{{ user.firstName }} {{ user.lastName }}</span>
          </div>
        </div>
        <div class="flex gap-2">
          <button pButton type="button" label="Atribuir"
            class="p-button-sm p-button-outlined hover:!border-orange-500 hover:!text-orange-500"
            (click)="assignUser(user, 'USER')"></button>
          @if(!apenasAtribuir){
          <button pButton type="button" label="Supervisor"
            class="p-button-sm p-button-outlined hover:!border-orange-500 hover:!text-orange-500"
            (click)="assignUser(user, 'OWNER')"></button>
          <button pButton type="button" label="Delegar"
            class="p-button-sm p-button-outlined hover:!border-orange-500 hover:!text-orange-500"
            (click)="assignUser(user, 'DELEGATE')"></button>
          }
        </div>
      </div>
    </div>
    <ng-template #noAvailableUsers>
      <div class="text-center p-4">
        <p class="text-surface-500">Nenhum usuário disponível encontrado.</p>
      </div>
    </ng-template>
  </div>
</div>
